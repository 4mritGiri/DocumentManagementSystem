{% extends 'package/table.html' %} 
{% block title %}Package List{% endblock title %}
{% block tableTitle %}
 Package List
{% endblock tableTitle %}

{% block linkOrModal %} data-toggle="modal" data-target="#addPackageModal"{% endblock linkOrModal %}
{% block tHead %}
<tr>
  <th>Package Name</th>
  <th>Document Type</th>
  <th>Packaging Size</th>
  <th>Status</th>
  <th>Destruction Eligible Time</th>
  <th>Condition</th>
  <th>Created At</th>
  <th>Actions</th>
  <th>QR Code</th>
</tr>
{% endblock tHead %} {% block tBody %} 
{% for package in packages %}
<tr>
  <td>{{ package.pkg_name }}</td>
  <td>{{ package.document_type }}</td>
  <td>{{ package.packaging_size }}</td>
  <td>{{ package.status }}</td>
  <td>{{ package.destruction_eligible_time }}</td>
  <td>{{ package.condition }}</td>
  <td>{{ package.created_at | date:'m/d/Y (H:i)' }}</td>
  <td nowrap>
    <a href="#" class="text-center m-1" title="View">
      <i class="fas fa-eye fa-lg fa-fw text-success"></i>
    </a>
    {% if not user.user_type|lower == "inputter"|lower %}
      {% if not package.status|lower == "Approved"|lower %}
        <a href="#" data-toggle="modal" data-target="#verifyPackageModal{{ package.pk }}" class="text-center m-1" title="Package Verification">
          <i class="fas fa-check-circle text-primary"></i>
        </a>
      {% endif %}
    {% endif %}
    {% if not user.user_type|lower == "Admin"|lower %}
      {% if package.status|lower == 'Pending'|lower %}
        <a href="" class="text-center m-1" title="Edit Package" data-toggle="modal" data-target="#editPackageModal{{ package.pk }}">
          <i class="fas fa-edit fa-lg fa-fw text-primary"></i>
        </a>
      {% endif %}
    {% else %}
      <a href="" class="text-center m-1" title="Edit Package" data-toggle="modal" data-target="#editPackageModal{{ package.pk }}">
        <i class="fas fa-edit fa-lg fa-fw text-primary"></i>
      </a>
    {% endif %}
    <a href="#" class="text-center m-1" title="Delete package" onclick="deletePackage('{{ package.pkg_id }}', '{{ package }}')">
      <i class="fas fa-trash-alt text-danger"></i> 
    </a> 
  </td>
  <td>
    <a href="/media/qr_codes/{{package.pkg_id}}_qr_code.png" target="_blank">
      <image src="/media/qr_codes/{{package.pkg_id}}_qr_code.png" alt="QR Code" width="50" height="50" />
    </a>
  </td>
</tr>

<!-- Include -->
{% include "package/edit.html" %}

{% include "package/PackageVerification/package-verification.html" %}

<script>
  function deletePackage(id, name) {
    const swalWithBootstrapButtons = Swal.mixin({
      customClass: {
        confirmButton: "btn btn-success",
        cancelButton: "btn btn-danger"
      },
      buttonsStyling: false
    });

    swalWithBootstrapButtons.fire({
      title: "DO YOU WANT TO DELETE THIS PACKAGE ???",
      text: "Package: " + name,
      icon: "warning",
      showCancelButton: true,
      confirmButtonText: "Yes, delete it!",
      cancelButtonText: "No, cancel!",
      reverseButtons: true
    }).then((result) => {
      if (result.isConfirmed) {
        // Send AJAX request to delete the package
        $.ajax({
          url: `/package/delete/${id}`,
          success: function (data) {
            swalWithBootstrapButtons.fire({
              title: "Deleted!",
              text: `Package: ${name} has been deleted.`,
              icon: "success"
            }).then(() => {
              // Reload the page or update the table after successful deletion
              location.reload();
            });
          },
          error: function (error) {
            swalWithBootstrapButtons.fire({
              title: "Error",
              text: "Failed to delete package.",
              icon: "error"
            });
          }
        });
      }
    });
  }
</script>
{% endfor %} {% endblock tBody %}
